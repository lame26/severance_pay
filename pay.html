<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KNOC 퇴직연금 시뮬레이터 v2.3 (승진가산액 포함)</title>
    
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== 전역 스타일 ===== */
        :root {
            --knoc-blue: #003DA5;
            --knoc-red: #E31937;
            --knoc-dark: #2c3e50;
            --bg-gray: #f8f9fa;
        }
        
        * { box-sizing: border-box; }
        
        body {
            font-family: 'Pretendard', 'Malgun Gothic', sans-serif;
            background: #eceff1;
            margin: 0;
            padding: 20px;
            color: var(--knoc-dark);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* ===== 헤더 ===== */
        .header {
            background: var(--knoc-blue);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 { margin: 0; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
        .header span { font-size: 0.9rem; opacity: 0.8; }

        /* ===== 레이아웃 ===== */
        .main-content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .input-panel {
            flex: 1;
            min-width: 350px;
            padding: 30px;
            background: #fff;
            border-right: 1px solid #eee;
        }
        
        .result-panel {
            flex: 1.5;
            min-width: 500px;
            padding: 30px;
            background: var(--bg-gray);
        }

        /* ===== 폼 스타일 ===== */
        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--knoc-blue);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--knoc-blue);
        }

        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 5px; font-size: 0.9rem; font-weight: 600; }
        
        .input-wrapper { position: relative; }
        .input-wrapper input {
            width: 100%;
            padding: 10px 35px 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            text-align: right;
        }
        .input-wrapper::after {
            content: attr(data-unit);
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
            font-size: 0.9rem;
        }
        
        .month-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }

        /* ===== 라디오 버튼 그룹 ===== */
        .radio-group {
            display: flex;
            gap: 10px;
            background: #f1f3f5;
            padding: 5px;
            border-radius: 8px;
        }
        .radio-option { flex: 1; position: relative; }
        .radio-option input { position: absolute; opacity: 0; cursor: pointer; }
        .radio-option label {
            display: block; padding: 10px; text-align: center; border-radius: 6px;
            cursor: pointer; font-weight: 700; font-size: 0.9rem; color: #666;
            transition: 0.2s; border: 1px solid transparent; margin: 0;
        }
        .radio-option input:checked + label {
            background: white; color: var(--knoc-blue);
            border-color: var(--knoc-blue); box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* ===== 승진 계산기 스타일 ===== */
        .calc-box {
            background: #f8f9fa;
            border: 1px dashed var(--knoc-blue);
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        .calc-header {
            font-size: 0.9rem; color: var(--knoc-blue); font-weight: bold;
            margin-bottom: 10px; display: flex; align-items: center; gap: 5px;
        }
        .calc-result-text {
            font-size: 0.85rem; color: #666; margin-top: 8px; text-align: right;
        }
        .btn-mini {
            width: 100%; padding: 8px; background: var(--knoc-blue); color: white;
            border: none; border-radius: 4px; font-size: 0.9rem; cursor: pointer; margin-top: 5px;
        }
        .btn-mini:hover { background: #002a70; }

        /* ===== 메인 버튼 ===== */
        .btn-calc {
            width: 100%; padding: 15px; background: var(--knoc-red); color: white;
            border: none; border-radius: 8px; font-size: 1.1rem; font-weight: 700;
            cursor: pointer; transition: 0.2s; margin-top: 20px;
        }
        .btn-calc:hover { background: #c0152e; }

        /* ===== 결과 카드 ===== */
        .score-cards {
            display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;
        }
        .card {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); text-align: center;
        }
        .card h3 { margin: 0 0 10px 0; font-size: 0.9rem; color: #666; }
        .card .value { font-size: 1.3rem; font-weight: 800; color: var(--knoc-dark); }
        .card.highlight .value { color: var(--knoc-red); }
        .card.primary .value { color: var(--knoc-blue); }
        .sub-value { font-size: 0.8rem; color: #888; margin-top: 5px; }

        /* ===== 차트 영역 ===== */
        .chart-box {
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.05); height: 400px;
        }

        /* ===== 승진보상금 알림 ===== */
        .bonus-alert {
            background: #fff3e0; border-left: 4px solid #ff9800;
            padding: 15px; margin-bottom: 20px; border-radius: 4px; display: none;
        }
        .bonus-alert strong { color: #e65100; }
        
        .info-text {
            font-size: 0.8rem; color: #666; margin-top: 5px;
            background: #f1f3f5; padding: 8px; border-radius: 4px;
        }

        @media (max-width: 768px) {
            .main-content { flex-direction: column; }
            .month-inputs { grid-template-columns: 1fr; }
            .score-cards { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1><i class="fas fa-chart-line"></i> KNOC 퇴직연금 시뮬레이터</h1>
        <span>Ver 2.3 (승진가산액 계산)</span>
    </div>

    <div class="main-content">
        <!-- 입력 패널 -->
        <div class="input-panel">
            <div class="section-title">1. 급여 정보 (평균임금 산정)</div>
            
            <div class="form-group">
                <label>직전 3개월 급여 (기본급+수당 평균)</label>
                <div class="month-inputs">
                    <div class="input-wrapper" data-unit="원"><input type="text" id="wage-m1" value="4,323,530"></div>
                    <div class="input-wrapper" data-unit="원"><input type="text" id="wage-m2" value="4,323,530"></div>
                    <div class="input-wrapper" data-unit="원"><input type="text" id="wage-m3" value="4,323,530"></div>
                </div>
            </div>

            <div class="form-group">
                <label>직전 1년 경영평가 성과급 총액</label>
                <div class="input-wrapper" data-unit="원">
                    <input type="text" id="wage-incentive" value="15,656,520">
                </div>
                <div class="info-text">※ 입력값 기준 현재 평균임금: 약 5,628,240원</div>
            </div>

            <div class="section-title" style="margin-top:30px;">2. 근속 및 가정</div>
            
            <div class="form-group">
                <label>현재 근속연수 / 향후 근무기간</label>
                <div class="month-inputs" style="grid-template-columns: 1fr 1fr;">
                    <div class="input-wrapper" data-unit="년"><input type="number" id="curr-years" value="11.5" step="0.1"></div>
                    <div class="input-wrapper" data-unit="년"><input type="number" id="fut-years" value="31.6" step="0.1"></div>
                </div>
            </div>

            <div class="form-group">
                <label>현재 예상 퇴직금 (DC 전환 시 이전액)</label>
                <div class="input-wrapper" data-unit="원">
                    <input type="text" id="curr-db-transfer" value="64,724,880">
                </div>
            </div>

            <div class="form-group">
                <label>수익률 가정 (임금 / DC / 통안채)</label>
                <div class="month-inputs">
                    <div class="input-wrapper" data-unit="%"><input type="number" id="rate-wage" value="3.0" step="0.1" title="임금상승"></div>
                    <div class="input-wrapper" data-unit="%"><input type="number" id="rate-dc" value="4.0" step="0.1" title="DC수익"></div>
                    <div class="input-wrapper" data-unit="%"><input type="number" id="rate-msb" value="3.5" step="0.1" title="통안채"></div>
                </div>
            </div>

            <div class="section-title" style="margin-top:30px;">3. 전환 시나리오</div>
            <div class="form-group">
                <label>향후 퇴직금 운용 방식</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="mode-full-dc" name="sim-mode" value="FULL" checked>
                        <label for="mode-full-dc">완전 DC 전환</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="mode-hybrid" name="sim-mode" value="HYBRID">
                        <label for="mode-hybrid">혼합형 (Hybrid)</label>
                    </div>
                </div>
            </div>

            <div class="section-title" style="margin-top:30px;">4. 승진 시나리오</div>
            <div class="form-group">
                <label>승진 시점 / 월 인상액</label>
                <div class="month-inputs" style="grid-template-columns: 1fr 1.5fr;">
                    <div class="input-wrapper" data-unit="년 후"><input type="number" id="promo-year" value="3"></div>
                    <div class="input-wrapper" data-unit="원"><input type="text" id="promo-raise" value="500,000"></div>
                </div>
                
                <!-- 5급->4급 전용 계산기 -->
                <div class="calc-box">
                    <div class="calc-header">
                        <i class="fas fa-calculator"></i> 5급 → 4급 승급가산액 계산기
                    </div>
                    <div class="form-group" style="margin-bottom:5px;">
                        <label style="font-size:0.8rem;">승급 전 기본급 (연액)</label>
                        <div class="input-wrapper" data-unit="원">
                            <input type="text" id="base-salary-annual" placeholder="예: 40,000,000">
                        </div>
                    </div>
                    <button class="btn-mini" onclick="calcGrade4Promotion()">계산 및 적용</button>
                    <div class="calc-result-text" id="calc-result-text">
                        기준보수 12% 가산 (4,500만원 초과시 20% 차감)
                    </div>
                </div>
            </div>

            <button class="btn-calc" onclick="calculate()">시뮬레이션 실행</button>
        </div>

        <!-- 결과 패널 -->
        <div class="result-panel">
            <div class="bonus-alert" id="bonus-alert">
                <i class="fas fa-gift"></i> <strong>승진보상금 발생!</strong> 
                <span id="bonus-msg"></span>
            </div>

            <div class="score-cards">
                <div class="card">
                    <h3>DB 100% 유지 시</h3>
                    <div class="value" id="res-db">-</div>
                </div>
                <div class="card highlight">
                    <h3>선택 시나리오 예상액</h3>
                    <div class="value" id="res-sim">-</div>
                    <div class="sub-value" id="res-sim-desc"></div>
                </div>
                <div class="card primary">
                    <h3>예상 차액</h3>
                    <div class="value" id="res-diff">-</div>
                </div>
            </div>

            <div class="chart-box">
                <canvas id="pensionChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
    // --- 유틸리티 ---
    const parseNum = (id) => {
        const val = document.getElementById(id).value;
        return parseFloat(val.replace(/,/g, '')) || 0;
    };
    const fmtNum = (num) => Math.round(num).toLocaleString();

    document.querySelectorAll('input[type="text"]').forEach(input => {
        input.addEventListener('input', (e) => {
            const val = e.target.value.replace(/,/g, '');
            if (!isNaN(val)) e.target.value = Number(val).toLocaleString();
        });
    });

    let myChart = null;

    // --- 5급->4급 승급가산액 계산 함수 ---
    function calcGrade4Promotion() {
        // 1. 기준 보수: 승급 전 연간 기본급
        const baseAnnual = parseNum('base-salary-annual');
        
        if (baseAnnual === 0) {
            alert("승급 전 기본급(연액)을 입력해주세요.");
            return;
        }

        // 2. 기본 가산액: 기준 보수의 12%
        let rawAddition = baseAnnual * 0.12;
        let deduction = 0;

        // 3. 차감 조건: 기준 보수 4,500만원 초과 시 초과액의 20% 차감
        const threshold = 45000000;
        if (baseAnnual > threshold) {
            const excess = baseAnnual - threshold;
            deduction = excess * 0.20;
        }

        // 4. 최종 연간 가산액
        let finalAnnualAddition = rawAddition - deduction;
        
        // 5. 월 인상액으로 변환 (연간 / 12)
        let monthlyRaise = finalAnnualAddition / 12;

        // UI 적용
        document.getElementById('promo-raise').value = fmtNum(monthlyRaise);
        
        // 결과 텍스트 표시
        const resultText = `
            기본가산: ${fmtNum(rawAddition)}원 
            - 차감: ${fmtNum(deduction)}원 
            = 연 ${fmtNum(finalAnnualAddition)}원 인상
            (월 약 ${fmtNum(monthlyRaise)}원)
        `;
        document.getElementById('calc-result-text').innerText = resultText;
        
        // 시각적 피드백
        const raiseInput = document.getElementById('promo-raise');
        raiseInput.style.backgroundColor = "#e3f2fd";
        setTimeout(() => raiseInput.style.backgroundColor = "white", 1000);
    }

    function calculate() {
        const m1 = parseNum('wage-m1');
        const m2 = parseNum('wage-m2');
        const m3 = parseNum('wage-m3');
        const incentive = parseNum('wage-incentive');
        
        let monthlyFixed = (m1 + m2 + m3) / 3;
        let avgWage = monthlyFixed + (incentive / 12);
        
        const currYears = parseNum('curr-years');
        const futYears = parseNum('fut-years');
        const initialPrincipal = parseNum('curr-db-transfer');
        
        const rateWage = parseNum('rate-wage') / 100;
        const rateDC = parseNum('rate-dc') / 100;
        const rateMSB = parseNum('rate-msb') / 100;
        
        const promoYear = parseNum('promo-year');
        const promoRaise = parseNum('promo-raise');

        const isHybrid = document.getElementById('mode-hybrid').checked;

        let dataYears = [0];
        let dataDB = [initialPrincipal];
        let dataSim = [initialPrincipal];
        
        let simMonthlyFixed = monthlyFixed;
        let simAvgWage = avgWage;
        let totalYears = currYears;
        let accumulatedFutureDB = 0;

        let realDC = initialPrincipal; 
        let virtualDC = initialPrincipal; 
        let totalBonus = 0;

        for (let i = 1; i <= futYears; i++) {
            const isPromo = (i === promoYear);

            if (isPromo) {
                simMonthlyFixed = (simMonthlyFixed * (1 + rateWage)) + promoRaise;
            } else {
                simMonthlyFixed = simMonthlyFixed * (1 + rateWage);
            }
            let simIncentivePart = (incentive / 12) * Math.pow(1 + rateWage, i);
            simAvgWage = simMonthlyFixed + simIncentivePart;
            
            totalYears++;
            dataDB.push(simAvgWage * totalYears);

            realDC = realDC * (1 + rateDC);
            virtualDC = virtualDC * (1 + rateMSB);

            if (isHybrid) {
                accumulatedFutureDB = simAvgWage * i;
            } else {
                let annualContrib = simAvgWage;
                realDC += annualContrib;
                virtualDC += annualContrib;
            }

            if (isPromo) {
                let targetDB_Past = 0;
                if (isHybrid) {
                    targetDB_Past = simAvgWage * currYears;
                } else {
                    targetDB_Past = simAvgWage * totalYears;
                }

                let compensation = Math.max(0, targetDB_Past - virtualDC);
                if (compensation > 0) {
                    realDC += compensation;
                    virtualDC += compensation;
                    totalBonus += compensation;
                }
            }

            let currentTotal = isHybrid ? (realDC + accumulatedFutureDB) : realDC;
            dataYears.push(i);
            dataSim.push(currentTotal);
        }

        document.getElementById('res-db').innerText = fmtNum(dataDB[dataDB.length-1]) + '원';
        document.getElementById('res-sim').innerText = fmtNum(dataSim[dataSim.length-1]) + '원';
        
        let simType = isHybrid ? "혼합형 (과거DC+미래DB)" : "완전 DC 전환";
        document.getElementById('res-sim-desc').innerText = `(${simType} 최종액)`;

        const diff = dataSim[dataSim.length-1] - dataDB[dataDB.length-1];
        const diffElem = document.getElementById('res-diff');
        diffElem.innerText = (diff > 0 ? '+' : '') + fmtNum(diff) + '원';
        diffElem.style.color = diff > 0 ? '#E31937' : '#003DA5';

        const alertBox = document.getElementById('bonus-alert');
        if (totalBonus > 0) {
            alertBox.style.display = 'block';
            let targetText = isHybrid ? "과거 전환분(11.5년)에 대해" : "전체 기간에 대해";
            document.getElementById('bonus-msg').innerText = `${targetText} 승진보상금 약 ${fmtNum(totalBonus)}원이 지급됩니다.`;
        } else {
            alertBox.style.display = 'none';
        }

        drawChart(dataYears, dataDB, dataSim, isHybrid);
    }

    function drawChart(labels, dbData, simData, isHybrid) {
        const ctx = document.getElementById('pensionChart').getContext('2d');
        if (myChart) myChart.destroy();

        let simLabel = isHybrid ? "혼합형 (과거DC + 미래DB)" : "완전 DC 전환";

        myChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'DB 100% 유지 (기준)',
                        data: dbData,
                        borderColor: '#003DA5',
                        backgroundColor: 'rgba(0, 61, 165, 0.1)',
                        borderWidth: 2,
                        tension: 0.3,
                        borderDash: [5, 5]
                    },
                    {
                        label: simLabel,
                        data: simData,
                        borderColor: '#E31937',
                        backgroundColor: 'rgba(227, 25, 55, 0.1)',
                        borderWidth: 3,
                        tension: 0.3,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { mode: 'index', intersect: false },
                plugins: {
                    legend: { position: 'top' },
                    tooltip: {
                        callbacks: { label: (ctx) => ctx.dataset.label + ': ' + fmtNum(ctx.raw) + '원' }
                    }
                },
                scales: {
                    y: { ticks: { callback: (val) => fmtNum(val/10000) + '만원' } }
                }
            }
        });
    }
</script>
</body>
</html>